package net.snowtiger.aoc

import AOC10.Move

/**
 * @author mark
 */

object AOC11
{
	val input = "...#......\n.......#..\n#.........\n..........\n......#...\n.#........\n.........#\n..........\n.......#..\n#...#....."
	val input1 = "...#...........#..............#..................................................#...................#...................#..................\n................................................................................................#..............#...........................#\n..................................#...................#.......................................................................#.............\n.......................#....................................................................#...............................................\n........#........................................................#.......#..................................................................\n..............................................#............#......................................................#.........................\n...............#.....................#...............................#...........................#..........................#...............\n....#...........................#................................................#.......................#..........................#.......\n............................................................................................................................................\n......................................................................................#......#..............................................\n............#.......#.......................#.....#...........#.............................................................................\n.........................#..................................................................................................................\n................................................................................................................#...........................\n..............................#.......#............................................................#.................#.................#....\n............................................................................................#...............................................\n.............................................................#.......#............#.......................#..............#.................#\n.......#....................................................................................................................................\n...............................................................................................................................#............\n...............#............#......#...........................................#.......#....................................................\n.........................................#................#.......#............................#.....#......................................\n...................................................#...................................................................#....................\n..............................................#.................................................................#..................#........\n...................#.......................................................................#................................................\n.#......................................................................#...................................................................\n.......................#.....#............#................#......................#.............................................#...........\n...............#....................#.......................................#................................#...........................#..\n............................................................................................................................................\n....................#................................................#...........................#.................#........................\n...........#....................................#...................................#.......#.........#.....................................\n..#...................................................#..................#.................................................................#\n..................................#...............................#........................................................#................\n..........................................................................................................#.................................\n......................................................................#.................#.......#.....................#.....................\n.......................................#..........#.........................................................................................\n......#........................#..................................................#.........................................................\n....................#.................................#................................................#.................................#..\n...........#...................................................................................................#............#...............\n...................................#.............................#.............#.................#.................................#........\n.............................#..........................................................#.................#..........#......................\n........................#................#..................#..................................................................#............\n...................#.....................................................#.......................................#..........................\n...................................................#.................................#...................................#..................\n..........#.............................................................................................#...................................\n......................................#.........................................#................#.....................................#....\n.....................................................................#..................#...................#...............................\n........................#..........................................................................................#........#...............\n.#...............................................#..........................................#.........#....................................#\n.............................#.............#..........#.....................................................................................\n..............#...................#..............................................#........................#.................................\n....................#.................................................#.....................................................................\n.................................................................................................#................................#.........\n....................................................#............................................................#..........................\n................#..........................................#.......#.....................#...............................#...............#..\n.....#................#.....................................................................................................................\n#...............................................#............................................#.............#....................#...........\n..........#.................#.............#............#....................................................................................\n.....................................................................................#......................................................\n..................#.................#....................................#......................#....................#......................\n.............................................................#................................................#.............................\n................................#.............#...................................#.......#.................................................\n.....................................................................#.........................................................#............\n...........#.........................................................................................#......................................\n.....................#..............................#.........................#.....................................................#.......\n..............................#.....#.......#.............................................................#.................................\n.....#................................................................................#...........#.............#...........#..............#\n................#...............................................#................................................................#..........\n#...........................................................................................#........................#......................\n..........................#.....#...........................................................................................................\n.........................................................#................#.............................................................#...\n......#............................................................................#........................................................\n.........................................#.........................................................#..........#.............................\n.....................#....................................................................#...............................#.................\n..................................................................................................................................#.........\n............#......................#.............................#.......#..................................................................\n...........................................................#...................#.............#........#....................................#\n#.......................................#........#..............................................................#...........................\n.................#..................................................................#.......................................................\n......................................................................................................................#.................#...\n............................................................................................................................................\n................................................................#.............................................#.............................\n......#.........................#........#............................#.........................................................#...........\n............................................................................................................................................\n.....................................................#.............................................#........................................\n.............#..........#.................................#........#........................................................................\n...................#.........................................................#.................#............#........................#......\n.............................................#.........................................#....................................................\n............................................................................................................................................\n.#.........#..........................................#....................................#................................................\n.................#...................#...................................#...............................#.......................#..........\n.......#..............#........#...................................................................................#........................\n................................................................#....................#...........#....................................#.....\n.........................................#.............................................................................#....................\n...#.....................#......................#............................#..............................................................\n...................................#..................................#......................#..............................#...............\n............#......................................................................................#........................................\n...............................#...........#................#....................#........................................................#.\n..........................................................................................................#.................................\n...........................#......................................#....................................................#............#.......\n...#.....#...............................................#................#...................#..................#..........................\n.............................................#................................................................................#.............\n...............#........#...................................................................................................................\n....................................#................#...............#.................#..........#.........................................\n..........................................#........................................................................#........................\n...........................#.....................#....................................................#.....................................\n.................................#.............................................................................................#............\n.........#.....................................................#...............................#............................................\n.............................................#............................#.............................................#................#..\n#..........................................................#........................#.......................................................\n.............#.......#................................................#.......#...................#................#........................\n..........................#................................................................................#................................\n.......................................#.......................................................................................#............\n......................................................................................#.....................................................\n.......................#.....#......................#...............................................................................#......#\n........#....................................#............#.............#...................................................#...............\n.................#................................................#...........#........................................#....................\n...........................................................................................#......#.........................................\n.#....................................#.........#...........................................................................................\n.......................................................#................................................#........#..............#...........\n...........#................................................................................................................................\n..................................................................................#.............#.....................#.....................\n............................................................#..............................................#........................#.......\n..#................................#.......#..................................#.............................................................\n.......................#.............................................................#.....#...............................................#\n.........#..........................................#..........................................................#............................\n................#........................................#...........................................#................................#.....\n...............................#........#.........................#.............#...........................................................\n.............................................#....................................................................#.............#...........\n....................................#........................#......................#...........#.......................#...................\n...................#.............................#.......................................#..................................................\n.............#..........................................................#...................................................................\n........#..................................................................................................#................................\n............................................................................................................................#............#..\n#........................................#......................#..................................................#................#.......\n.....................#.............#.....................#............................#.........#...........................................\n.....#.....................#................................................................................................................\n.........................................................................#..................................................................\n.............#...............................................#....................#..................................#........#.............\n........................#...........................#....................................................#..................................\n........................................#........................#...............................#.............#..........#..........#......\n..#.......................................................#...................#.............#..............................................."

	def main(args: Array[String]): Unit =
	{
		val lines = input1.split('\n').toList
		val by = 1000000-1
		val u = extract(lines).expandHoriz(by).expandVert(by)
		u.print()
		println()
		val g = u.galaxies
		g.print()
		println()
		val s = g.sumOfDistances
		println(s"Sum of distances $s")
	}

	def extract(lines: List[String]): Universe = {
		val w = lines.head.size
		val h = lines.size
		Universe(lines.map(_.toVector).toVector, (0 until w).toVector.map(_.toLong), (0 until h).toVector.map(_.toLong))
	}

	val EMPTY = '.'

	case class Universe(a: Vector[Vector[Char]], xs: Vector[Long], ys: Vector[Long]) {
		val w = a(0).size
		val h = a.size
		def print() = {
			println("X indexes "+xs.mkString(" "))
			println("Y indexes "+ys.mkString(" "))
			a.foreach(l=> println(l.mkString))
		}
		def get(x: Int, y: Int): Char = a(y)(x)
		def expandedPoint(x: Int, y: Int): Point = Point(xs(x), ys(y))
		def expandVert(y: Int, by: Long): Universe = Universe(a, xs, ys.slice(0,y+1)++ys.slice(y+1,h).map(_+by))
		def expandHoriz(x: Int, by: Long): Universe = Universe(a, xs.slice(0,x+1)++xs.slice(x+1,w).map(_+by), ys)
		def expandVert(by: Long): Universe = {
			var u = this
			for (y <- h-1 to 0 by -1){
				if ((0 until w).forall(x=> u.get(x,y)==EMPTY))
					u = u.expandVert(y, by)
			}
			u
		}
		def expandHoriz(by: Long): Universe = {
			var u = this
			for (x <- w-1 to 0 by -1){
				if ((0 until h).forall(y=> u.get(x,y)==EMPTY))
					u = u.expandHoriz(x, by)
			}
			u
		}
		def galaxies: Galaxies = {
			var xs = List[Point]()
			for (y <- 0 until h) {
				for (x <- 0 until w) {
					if (get(x,y)!=EMPTY)
						xs = expandedPoint(x,y)::xs
				}
			}
			Galaxies(xs)
		}
	}

	case class Point(x: Long, y: Long) {
		def distFrom(other: Point) = (x-other.x).abs + (y-other.y).abs
	}

	case class Galaxies(xs: List[Point]) {
		def print() = xs.foreach(println(_))
		def sumOfDistances: Long = xs match {
			case p::tail => {
				tail.map(_.distFrom(p)).sum + Galaxies(tail).sumOfDistances
			}
			case _ => 0L
		}
	}

	def tokens(s: String): List[String] = s.split(' ').toList.map(_.trim).filter(_.size>0)


}