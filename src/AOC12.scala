package net.snowtiger.aoc

import scala.collection.mutable

/**
 * @author mark
 */

object AOC12
{
	val input = "???.### 1,1,3\n.??..??...?##. 1,1,3\n?#?#?#?#?#?#?#? 1,3,1,6\n????.#...#... 4,1,1\n????.######..#####. 1,6,5\n?###???????? 3,2,1"
	val input0 = ".??...?##. 1,3"
	val input1 = "?.???#????? 1,3,1\n..???#??????#?????? 3,6\n???#??.????. 4,1,1,2\n??#?????????#?##?? 4,4,2,4\n??..???.????#??? 2,1,6\n?#???#.????.??. 2,1,1,2,2\n#??.???### 1,1,5\n?????#?###?#???.???# 3,9,1,1,1\n###????.??#####.??? 6,5\n.?##???.#? 3,2\n?.?#??#??..# 3,1,1\n?.?????.?????? 1,3,1,3\n.#.?#?.???. 1,3,2\n??#?#????#..???????? 5,1,4,2\n??.?#??##?? 1,1,2\n?????.????##?#? 1,1,7\n?#?#??..#?. 5,2\n???.#???.????#???? 1,1,1,1,6,1\n?.??##?#????? 6,3\n??..??#?#????????.# 1,1,1,1,4,1\n??????##???????? 2,4,6\n?##..?##?##??.?#.? 2,8,1,1\n???#??.?###.?????. 3,3,2\n..#?...?#?? 2,4\n#?.?#.?.???#?#? 2,1,1,1,4\n???##?.??#?.?? 6,1,2,1\n.#????.??? 1,2\n?.?..##??#?#?#??.. 1,1,2,4,1,1\n?#??#?#??#?#?.??#?? 11,4\n??#?##??##???? 1,8\n???#??.#?? 2,1,2\n??#???#??.#.?#??#??? 3,2,1,8\n????#???.???# 1,1,2,2\n??#?.????? 4,2\n???????..?##???.? 4,6\n???.??????.??? 1,1,6,2\n???.#???????.#??? 1,1,2,1,3\n?.#????????? 1,1,1,1\n?#???????????.??#.?. 5,1,1,1,1,1\n????##?##?#???#?#??. 1,10,2,1,1\n???#?.?.?? 5,1,1\n.????#??#.#??# 1,4,4\n?????..??##.?..?? 1,4\n#?#???#?##??.??????? 1,10,1,1\n??.????#????#????? 1,1,12\n#?.#.???###???#??? 1,1,1,6,1,2\n?.???.?????????#.?? 1,4\n?##?###?????##.#??#? 7,3,1,2\n???#?????? 3,1\n.?#????#?#?.#???#?? 7,1,2,2\n.?#??.??.####.#? 1,2,4,1\n?.?.?????##.?.?.#.? 1,1,4,1,1,1\n.????.??#??????## 1,3,5\n?.###???????? 1,3,2\n????????????. 7,2\n???.?###.##???#?.?? 3,4,6,2\n??#?#?###??????.?? 7,3\n#.??#????? 1,1,3\n.??#?#?.??.?#? 3,2,1,3\n?.?#????.?. 2,1\n???.?#??#????? 2,6,1\n#??????##????? 1,1,8\n???.##..??#?#?#.??? 1,2,1,1,3,1\n???.?????#??????? 2,6,2,3\n????#???#??#??.??#?? 2,9,3\n??????????.?#? 3,1,3,3\n??#?#????#? 1,1,4\n#??##???#???? 10,1\n#?.??????#???.# 2,7,1,1\n??#?.???#??????. 1,8\n.?##?????#?? 3,3\n?....??????.#.?. 1,5,1,1\n.???#.????? 2,1,2\n??#??????#?#????##? 1,16\n##?.#?????#???.#??? 3,2,3,2,2,1\n???##???##????.???? 10,3\n??.???.???#?.?? 2,2,3\n.??#????..???# 5,1,4\n?#?.?#?#??#?#???? 1,12\n.?#??.??#?? 2,3\n?#?#???#????? 4,4,2\n.???#..????#? 1,5\n?##?#??????..???? 8,1,1\n#?##??.?#.#???##???? 6,1,1,6\n#??.????#?? 1,1,6\n#???#????.??????#??? 1,3,1,1,7,1\n?.?#?#?.?#????. 4,1,2\n##??.#?????.# 2,1,2,1\n?.????????##??# 6,4,1\n?..#....?# 1,1,1\n?##??.??#??#? 4,2,3\n??#??????????? 3,4,3\n.#???.???????? 3,5,1\n???.?.????????.? 1,5\n????##????? 3,2,2\n???##?##???#??????# 10,2,1,2\n?#?.???????#? 3,1,1,1\n???#????#??# 1,2,4\n?.??#..??? 1,3,2\n?.??#???.??? 3,1\n??????#??## 1,6\n.?#?.#???? 2,1,1\n?????????##.? 1,7\n?..?.?.?#??? 1,4\n.?#??#????????#.#? 3,1,2,1,1,1\n?.???.?#??.. 1,2\n?#?#????.##?##???# 4,2,5,1,1\n?#.#??#?#?#?? 1,8\n##?.????##? 3,6\n?????????? 1,2,1\n??.#??.#??. 1,1,1\n?#??#.??#???.?#. 5,3,1,1\n??##?#?????. 5,2\n?.??#?????? 3,2\n#????????? 1,7\n??.#?..???#? 1,5\n##???##?#?? 2,4,2\n?#?.??#??.?.? 2,3,1\n???##???.??# 1,5,1,1\n?#??.?.?#.????# 1,1,1,3,1\n?.?.#.?????????#.# 1,1,1,6,1,1\n??#?????#???##??#?## 5,12\n?#???#?????. 7,2\n???.?#???? 1,2\n???.??????.?#??#?? 2,1,1,2,1,1\n???#?.#?##? 2,1,5\n?#??.??.?? 3,2,1\n??#.???#.???. 1,2,1,2\n??.??????????##..??? 4,7,2\n???#??.##?????.. 1,1,7\n???#????#..#?.??? 6,1,2,1\n????????#? 1,4,1\n###?????.####.?? 5,4\n?#?##??#.??. 7,1\n?#????????????#?? 2,6,1,1,1\n.?#?????#??? 2,5\n??#????#####?#.# 4,6,1,1\n?????#???#??? 2,6,1\n.?..????.#?? 1,1,1,3\n..?????#?#?###?. 1,10\n?.##??#??.??.???#? 2,2,1,4\n???????.#????#?#?.# 1,1,1,8,1\n???#?.??.??? 5,1,1,1\n??.?#???#?????.? 1,2,5,1,1\n.??.???#?##? 1,1,1,2\n.?#.?#?????# 1,1,3,1\n#?##?????###???????. 1,2,1,7,1,1\n.##???#.??#??.? 3,2,1,3,1\n??###.??.?????? 5,1,1,2,1\n?.??####??????.#???? 7,2,5\n?????#?.?? 3,2,1\n???????.??#?? 1,2\n.?.???#?#??.? 1,1,5,1\n????.??.##???. 2,2\n??.#????##???? 1,1,1,6\n?.???##????.??. 1,1,5,2\n????.??????##?#??? 2,11\n??????#?####???# 12,1\n?#???.???# 3,1,3\n?????????#?#? 1,2,6\n???.??#.?. 2,3\n..#..?#?.??.# 1,3,1,1\n?#?#???#.#?#.?? 3,3,1,1,1\n?#?##?????? 6,3\n.?#???#.?.?##?#????? 2,1,1,9\n??.??#???## 1,3,4\n.#?.?????..?#??? 2,4,5\n?#????#.??? 3,1,1\n??.#???#?###????## 1,1,13\n???.###???#???.#. 2,7,1,1\n.????.?.?????? 3,1,3\n#???????????..#.. 4,1,1,1,1\n?.?.##??.??.????. 1,1,3,2,4\n???????.????? 4,1,1,1\n??#??#.????.?? 6,3,1\n???#?????##????##?? 1,3,1,10\n?#???#????.?##?. 1,1,2,2\n??????#?.???#.? 1,3,1,2\n##???????? 5,3\n?#?###?.?.???????# 6,1,1,1,1\n???????.#?? 1,1,2\n.????.??#?.?#.??.. 2,2,1\n??????..?.?.??.. 4,1,1\n#???#??#??????##? 2,1,10\n??????..#.???. 1,1,1,3\n??????????#????# 6,3,1,1\n??.?????.? 2,2,1\n?.?????#???.??# 3,5,2\n#?#.???#??..?#? 1,1,1,3,3\n??.??..??#.???##???? 1,2,1,1,6,2\n?.??##?##?.?.??#??? 8,4\n#????##????????#?# 1,1,2,4,4\n#?#.???#?.?????? 3,2,1,6\n#??????????..#??? 2,5,3\n????.??.??.#.#?#?? 3,1,2,1,1,3\n???#?##??? 6,2\n????????.#?? 1,1,1,2\n##?.#????#?#?. 2,1,2,1\n??#??????#??#?. 1,1,1,2,5\n????..???? 1,1,3\n.?..?#.?????.?? 1,1\n.?##??.#..?????#? 2,1,6\n??.?#..???? 1,1,2\n#??#??#???????????? 4,1,2,2,2\n..???.??????#?? 1,3,4\n?.#??.??????#? 1,6\n#??????#???##???? 1,2,4,4,1\n??.??????? 1,1,3\n.???#???##????#? 1,6,4\n??#???.????#. 3,1,4\n#?.??????? 1,1,1\n??##???????????????# 1,4,1,1,6,1\n#?????##????????? 1,1,5,2\n##?????#?##?#?.? 2,10\n##???#.?#.?##?. 3,1,1,3\n??#?.????? 3,1\n.?#.???.?#?#???#??? 2,1,1,6,4\n#???#?#??????. 1,3,1,2\n.??????.?.??. 1,3,1,1\n.??##????.? 5,1\n..??.???##??????..? 1,5,1\n.#..???????? 1,3,1\n??.???.???###.??.? 2,6\n?##????#?#..?#? 3,3,1,3\n??#.??#.???#? 2,3,5\n?#???#?????##????#.? 5,1,5,1\n??.???###?????????? 8,3\n?##?#?#?...#????#??? 7,1,5\n???#???#??#.????? 1,6,2,4\n?.?#???##.? 4,2\n.?.????####. 1,5\n?.#??.?#?. 3,1\n..?#??.??.?#?#???? 3,6\n?.??????#? 1,7\n?.????.??.?####???? 1,2,1,1,6,1\n?#..#????????? 1,1,3,1\n?#????##.???#???? 3,3,4\n.???.?#?..# 1,2,1\n.##?#?###??.??? 9,3\n#?.????#??###??##? 1,5,5,2\n?????????#. 6,1\n#?????.#?. 5,2\n??????????? 2,3\n.??#.???....#.? 3,1,1,1,1\n??.??#??????.???? 1,4,1,3\n.?#.#?#???##???#. 1,1,1,1,6\n?#..?.?.??? 2,1\n?????.?#?. 1,1,2\n??#?#??????#???? 8,2\n???..???##?????.? 2,6,1,1\n?.????..??#?.? 1,3\n???.??.?#?#.? 1,1,3,1\n?#???###?##?? 1,7\n??.####?????#.... 6,1\n???#?.#?.?? 2,1,1\n?.???#??#?#.????? 1,4,1,1,3\n?.??.????????. 1,4,1\n.?#????#???.? 4,2,1\n#?#.??.?.?###?????.? 1,1,1,1,3,3\n?#??.??##??#?##?#? 4,8,2\n.?????.#?? 1,1\n??..#?.??????#? 2,1,7\n??##????##?.?? 1,9\n?#????#?#?.?.?? 4,1,2,1,1\n?#???#??.????#? 1,4,1,2\n??.????#?. 2,2,2\n??????#.???##??? 4,1,1,3,1\n?##??##?.???.##?. 2,3,1,2\n.????????#?. 5,1\n.??.????????#? 1,2,5\n??.??##?#?.????????? 1,1,2,1,8\n#?###?????# 5,1,2\n#?.???#..? 1,3\n.??????.#?.#.? 4,1,1\n?.??.???#??#? 2,1,2,1\n????..???##?????? 1,5\n??#??????.????#.. 7,5\n?###???#?.?.???## 7,4\n??.?.?????.?? 1,3\n???#??????????? 1,1,2,1,1\n.??#.????? 2,4\n.???????.?#? 3,1,1\n#.?.#??#???? 1,2,1,2\n???#??##??????#??.?? 11,1,2,1\n#???????.?#?..?#? 3,1,1,3,1\n?#?#.?.????.??? 1,1,1,1,1\n???.#????????? 1,9\n???##??????.?#???# 9,1,1,1,1\n?..?????????.?...? 1,2\n????.#?#?#? 2,1,5\n???#????.?#???.??? 1,2,1,3,1,2\n???.##??????.?#? 1,5,1,1\n..????????#? 3,3\n?.?#??#.??????.#? 1,4,1,1,2\n?.???.??.? 1,1,1\n??????##?#?#?.????# 8,4,2,1\n??#?#?????#. 7,2\n.??#???.?.#??????##? 2,1,9\n.?##??#????.? 2,5\n.?.?##?.#.?.##.?#? 1,2,1,1,2,2\n?????#???#?. 1,6\n.#???????#????#?##?# 2,11,2,1\n???#???????.#??.?? 1,5,2,2,1\n????????.????##???#? 2,2,8\n??????###?#?????#??# 8,1,6,1\n???#?.??###.?? 1,1,4,1\n??.???#???##??.#?#?# 1,10,1,1,1\n??#?#?????#?????? 3,3,1,1,4\n..?????#?.#. 3,1,1\n??????????.??#????# 3,4,2,3\n?..?#?.??.#???#?#?. 1,3,1,3,1,2\n.???#???#?? 2,3\n?.?#?..?#?? 1,1,2\n???????#?? 1,1,3\n???.??...? 3,1\n??##.??.?????#.????? 2,6\n??#???#?#???.? 1,8\n?##??????? 6,2\n????????????#?#?? 5,4,1\n#.????#?.?. 1,1,2\n???#??.?#. 1,3,2\n#?.???#?????.# 1,1,7,1\n?###..??.??? 4,1,2\n#??????..#?? 3,1,1\n???#???#?#?#???.?? 1,13\n???????#??????## 5,1,6\n.??.???.???###. 2,1,5\n#.#???#??#?#?????# 1,1,8,1,2\n?..????##?.#? 1,1,4,1\n????###?????#??? 1,10,1\n????##?????? 2,2,4\n.?????????##?? 1,9\n.?.?##.?#?#? 3,3\n..??##?##?#?#??? 4,7\n????##????#??????? 4,4\n#??#??#??? 4,4\n??.??????#??##?. 1,1,6\n?.??#?????.#??#? 1,3,1,1,1\n.??#????#????## 8,1,2\n.?##..???..? 2,1\n??.??????? 1,2,1\n?.?#?????#?#?.#..?.? 1,11,1,1,1\n??????.?.??? 4,2\n..????????? 3,4\n???#?#?#?.?#.?? 9,2,1\n??##?##??#? 6,1\n?.?.?#???#. 1,1,5\n???#????#???##???.. 9,4\n?##???#??? 3,1\n.?#?.?.#??? 1,3\n????????????#?. 6,1,2\n.##?#??#?#?# 9,1\n?#?#.?..?. 3,1\n#????#.?.??? 2,1,2\n??..#????..??##? 2,5,3\n??##?#??.??#???##?.? 6,1,5\n??????..?? 2,1\n#??#?.????#?.#?.? 1,1,5,1,1\n???##???.#?#?? 5,3\n??#?#??.????? 4,1,1\n.#??#?#??#.?.?##?? 6,1,1,4\n.?..????.??#? 2,3\n#???#??###.#? 5,3,1\n?#?#??###?????#? 10,2\n??.?#??#.?..????.??? 1,5,1\n#??#.#??#?????.?#?? 2,1,4,3,2,1\n???##??...????????#? 1,5,1,2,5\n?#?????????????.???# 4,4,1,3\n.#?????##?????# 8,1,3\n.??##??????##?? 4,3,2\n?????#.?#?.?????.# 1,1,1,2,2,1\n???????.?#? 1,1,2\n??#.???#????# 3,1,1,3\n#?????#??? 1,3,3\n??.??#?##.#??? 6,3\n?????.?????. 1,2,2,1\n?????.????#?????? 1,1,4,1\n??##?????.?????##?? 1,5,1,2,5\n.?????#?#?#.?.#.# 8,1,1,1,1\n???#?#?????##???.?? 16,1\n????.#????.????#?? 1,3\n???#??.#??? 4,2\n??.#.?#?#?????# 1,1,5,1,2\n#?#???#.???????#???? 1,5,1,3,3\n.?#????#???????? 1,1,1,1,4\n???.???#??????## 1,1,9\n#??.?##?.???#? 1,3,5\n???.??.??..??? 3,1,1,2\n#????.#.#? 3,1,1\n?#?##?#??#?..?????## 9,2,1,2\n????.#??#???.????? 1,1,2,4,1,2\n#??..??.????? 3,1,1,1\n#???#??#????? 3,1,6\n??###??#??#?##???#. 3,2,8\n??#???.?#????? 3,5\n????##??.????#?#? 1,3,5,1\n#?.?....?#. 2,1,1\n?.##??##???#????#? 11,4\n?#?..#?.???#?#?##. 3,1,7\n?????.?.#.?.?. 5,1,1,1\n??#???.#??? 4,2\n?#..???#?#?##??#?. 1,10\n#?..??????? 2,5\n???##??????. 1,2,1,1\n#??.???????????#??? 1,1,1,7,2,1\n??.???##??#???? 1,1,3,3,1\n?####?#?#?????.???? 12,1,1\n???##?##?.#?.??#?# 1,6,2,5\n???#.?.### 2,3\n?#.#??.#?#??? 1,3,3\n???#.?##?.?.#????? 1,1,4,1,1,3\n?.#???#.?.#?.????? 1,5,1,1,4\n???#???#?????.???.? 3,2,2,1,1,1\n??#??.??####?.#?.?. 1,1,6,1,1\n?.????#????#?.??#?# 1,1,5,2,5\n?????.?????#?. 2,1,2\n?.?.?#?????.????.?.? 2,1\n?##???????#?????? 2,2,6\n????#?#???#??#? 11,2\n.?#?#...#?##????? 4,1,4\n?#?.?????###???.??? 3,10,1\n#?##????.#.????##?? 8,1,6\n???????????? 1,4,4\n.?..?.#?#??####??# 1,1,12\n??#??#????##??#.???? 3,10,2\n?????????#????#?.?? 1,4,4,1,1\n?#????????????. 1,1,6,1\n#?????##??? 8,1\n?..?.?#??#??#??. 1,1,9\n.?????#..?? 2,2,1\n?#???????????.? 7,2\n?.??.?#????#? 1,1,7\n?????##????. 2,4\n???????..#?.? 3,2\n?????#.????.?.? 6,2,1,1\n#.?.#??.??? 1,3\n???????????##?????. 1,1,8,1\n?????.#.??#?? 1,1,1,4\n????.#?????? 3,1,1,3\n????#????##???? 1,9,1\n?.???#?..#??????#? 4,4,2\n?#????.??#??#???.? 2,1,4,4,1\n.#??????#?#?##?? 2,11\n.?.???????#??? 1,1,2,2\n#?.??..??.?.#??? 2,2,2,2\n?..#?.??#???#.?##?? 1,5,4\n?#????#??#?????#???. 4,1,1,4,1\n??.??#???.?.???#.. 1,2,1,1,4\n.???????#?? 1,5\n???#?#?????? 2,4,1\n?.??#??#.??? 1,1,1,1\n?.?#...??#??#?. 2,1,5\n.??#??.???? 3,1\n#.??.???#?? 1,4\n?????.?#?#???? 1,5\n?#.?#???#.. 1,5\n#????????????.????? 1,1,1,4,2,2\n?#?.??##????????? 2,5,2,1\n???.?????.????? 3,1,5\n.?.?????#???.???? 1,9,2\n??????#??#??.#?? 1,8,2\n?#???#????. 1,2,2\n?#???#??.?#??#???? 6,2,3\n#??????#???.?.?? 3,4,1,1,1\n????.??.?.?????###?# 3,1,1,8\n#.?.?#?????.?????.. 1,2,1,2,1,3\n.?.?##???????? 7,1\n?#?????#???#?? 5,5\n#.???##??? 1,5\n??????.##? 1,1,3\n.?.????..? 1,1,1\n???#?????#?????.?.?? 1,7,1,1,1\n??????????#.??#?? 1,3,1,1,4\n.#????###? 1,7\n??.??#...?#.?? 2,2\n???????#?#?? 1,5\n??#?#?..?#???? 6,1,2\n?#?#????#????????? 2,3,2,2,1\n????.#??#? 1,2,4\n????#..??.?.?##.. 3,2,1,2\n.?#?.#?.?#????###?? 3,2,9\n.????#?#?#????????? 1,4,1,7\n?#?..#??#??. 1,6\n.?????.#????#?..#?? 1,1,1,1,3,3\n???.??.?#? 2,2,2\n???#?##??#?#.?..? 2,7,1,1,1\n##??#??#??????#? 9,1,1,1\n?#?#???#.???????. 4,1,4,1\n???##??#?#.?? 1,7\n??????#?????????? 2,1,1,2,2\n?#?##???#?? 1,2,4\n?.???##??????????? 1,14\n??.?#?????#? 1,3,2\n????#???#??.?.?????. 1,7,1,1,1\n??#??.##?##??????# 3,8,1,1\n???#??#?.???? 2,3,4\n?.??#?????? 1,4\n??#??#???#??##?? 3,3,1,2\n???????#??#?..#?#??? 12,1,2\n#?#???#????#??? 3,1,1,5\n.??..?##?#.??##....? 4,2\n##???#??.#????? 2,2,6\n?#?????.???..??????? 5,2,3,1\n???????#???#??.??.?. 2,11,1,1\n?.??#???#????.. 2,3,1,1\n..??..???#.???????? 2,1,5\n???????....? 3,1\n???#????#??#????#? 1,1,11\n??.????..?#? 1,1,2,1\n#?.?#?.???? 1,1,2\n?#????.??.#? 1,1,1,2\n???#?#???#?? 4,1,1\n???##?.?#..?.# 5,2,1,1\n???##.?#???##??#??? 5,10,1\n???#??##.??##.??? 5,2,1\n.?##?????..?##???.? 8,2\n#??#.?.??#.? 2,1,2,1\n.?#?#?.##.#? 4,2,1\n??##?.???#?#??#??#? 3,9\n.?.??###??#.#?.? 1,4,1,2,1\n??#?.?????#? 1,1,1,1\n.?#??#?##..?#??#.# 8,5,1\n?????#?#???.#.?.?? 1,2,6,1,1,1\n.???????#. 3,1\n#?#.?????????#?? 3,3,2,2\n.????..#?# 1,3\n?#????.#.?###??.??? 5,1,5,1,1\n????#..#?#??#.??..? 2,1,3,2,1,1\n????##??.#?# 3,3\n#???#?????????##?## 1,1,2,3,3,2\n#????????? 1,2,2\n..?#?????????. 8,2\n.##..???#???#?.# 2,1,1,4,1\n.???.??????.?#?.??? 3,3,3,1\n?.#??????#? 1,1,4\n?#??.????#?##?? 1,3,4\n.??????.??? 5,1\n??.??.#.??#? 1,1,3\n?#?????????..??????? 9,1\n.??#?#???????????# 5,1,1,2,2\n##???.??#??# 5,5\n???.?????# 2,2\n?#???????????#?? 5,4\n?#???#.???#.?###??#. 2,2,1,2,3,2\n#?.??????? 1,1,3\n#???#????.#?.#? 8,2,1\n?#.#.??????#??.???? 1,1,1,4,2,1\n.#?#??.?????????? 3,1,1,1,2\n??????#?????#???? 1,3,7\n????.??.?##.. 2,1,1,2\n..?#???.??.??.??#??? 4,5\n?###????##??#??#. 5,10\n?#?#????????.??? 10,1\n???#??#?.?#.??? 6,2,1\n???????##??#?????.# 1,1,6,1,1\n??????#.?? 1,1,1\n?##??##.?#???. 6,3\n.?#??#.??#?#??.? 1,1,4,1,1\n???????????????#.? 12,3\n.??#?###?.#????#?. 6,4,1\n#?????????? 4,1\n?????.????.??. 1,3,2\n??.????###?#.???. 2,7,1\n?.???????.???#??#? 1,6,1,1,3\n???..????##??#?.?? 1,10\n?????.????????? 2,7\n???.????????##???.? 2,11,1\n#?#...???????#??#??? 3,3,7\n?#.?#???#? 1,2,3\n??#?.?????#.??? 3,1,1\n???#??????? 1,3\n?????????#?#?.??.?. 11,1\n?#?????????.????.??? 11,4,2\n??????????????#.? 2,1,2,1,2\n?#.##?????#?#?# 1,4,2,1,1\n?.??.???????#???#.? 2,1,6,1\n??#????#?#.????. 3,3,1,1\n?.??.?.??#?.?.? 2,1\n??????#??? 1,2,4\n#..###???#. 1,7\n????..#.???.? 4,1,3,1\n??.???##?. 1,4\n???#.???#???.?????? 2,1,1,2,5\n?????#?##? 1,6\n##?##?#?##????????. 10,2,1\n.?..????#???? 1,1,5,1\n?#???#?.?????.#. 2,1,1,3,1\n#?????..?.#?? 5,1,1,1\n????????????? 1,3,2\n.?.???##??????? 1,10,1\n.?#?..???.###? 2,1,3\n?..??##?..? 1,4\n#?.???##?????.??.? 1,1,6,1,1\n###??#???.????# 3,1,1,1,1\n???.#???.#? 1,2,1\n???.?#?#??????. 5,1\n?????????#?#???? 3,5,1\n??????#????##?. 1,7\n??#????#????#??????? 2,15\n?????##??#?????#? 6,7\n??###?.??? 3,1\n??.##????#? 1,2,2\n??#??.?????? 2,2\n??#??????.???#####.? 3,1,7\n??#?.?..?.? 2,1\n?.??.#?#?#????.?? 1,2,6,1,2\n#?#.?..#.?????. 3,1,1,2,1\n??#???.???? 5,1\n##?????.?.??????.? 7,2,2,1\n.???#?#???? 1,8\n.?##?####.?.????? 8,4\n.?...##??#????????. 1,11\n??#..?#??? 1,1,1\n.?.??.???#?????#??#. 1,1,1,11\n?#???#???.#????? 2,5,1,1,1\n.?#?.?.?##??.? 3,3,1\n.??#?.???#??? 1,4\n?#????#???#?... 2,2,2\n.?.?#?????#???.. 1,3,1,1,1\n#???.?#??# 1,1,5\n?????????## 1,1,5\n????#??.####?? 1,4,4,1\n.??????#?#???????? 1,1,11\n?.?#.?#?.??????. 1,1,1,5\n???#?.?.????????#?? 2,1,1,1,2,5\n##????#????. 8,1\n#..###??#?#?# 1,10\n?##.??.#.???##.? 2,1,1,4\n#?##?#???? 7,1\n???#????#???## 5,1,4\n?.?#?.???#? 2,1,1\n..???????? 2,2\n???.??#???????? 1,3,6\n????.?#??#????##?#?. 1,1,2,1,2,4\n???????.?..??##???#? 1,2,1,4,1,1\n.?#????.???##????#?? 3,2,9\n?#??#.??#????????? 3,1,2,1,3\n???#??#..?? 4,1\n?.??#?..?. 3,1\n???????#?#?#?##?#? 3,4,1,5\n#?.??..????##?###? 2,1,1,8\n?..?####?#??#?.?? 1,10,1\n#?...???..? 2,2\n??????#?????? 1,1,7\n????????????#? 1,2,6\n.?.#??????#?#??? 1,2,2,7\n???##??#?#.????#???? 10,2,1,3\n.??#??#.???#? 6,5\n####????.#?#?.?.#?#? 4,1,3,1,2\n?.????.#?.?##?#? 1,3,1,5\n.??????????#.?#??. 2,2,2\n???##????#?..?. 5,2,1\n.????#.?#?#???? 1,3,7\n??.??????? 1,2,1\n#?##?????????##?? 4,1,1,1,4\n??#?#?.???? 1,3,1\n?..#???#?#??. 1,3,5\n?#????????#???? 2,11\n#?.#?.#?#?##..???#?? 1,2,6,5\n??#??????.??.??#. 1,1,5,1,3\n?.????????#? 1,1,1,1\n??##?.???#?. 4,4\n?#??????.?.?#?. 1,2,2,2\n??.#?#?????...#? 1,1,1,2,2\n...?????.?##??.? 2,3\n..??##????. 1,4,1\n????.?..???#??#?? 1,1,1,7\n.?.??????#. 2,4\n..???..#.? 1,1\n?.?????????#.?? 2,2\n??.#.?#?.?#?#?????? 1,1,2,6,1,1\n???#?????#??? 1,7\n?##?##.???#?????.?? 6,3,4,1\n??###..????#??#..?#? 4,4,2,2\n#..????#?#?#?####.? 1,1,1,1,8,1\n???#?#?###?#?.?##?.? 9,3\n.###?#?#???.??.??? 9,1\n??###???#??#? 7,4\n.#?.??#????? 2,1,1,3\n?#???#?#?.??##???#?. 8,1,3,3\n???????#?. 1,1,1\n##.?##?????????? 2,10\n#.#?.#????#? 1,1,1,1\n.#.?????????#? 1,2,2,1\n.#????.##? 1,2,2\n??????#???##? 1,3,3\n?#?#?.?#??.??? 4,3,1\n?.#??#?#?#???#?#??? 1,16\n?.#???#?#???.##????? 2,2,4,4,1\n????.??#???#??.???#? 1,2,1,1,1,4\n?##???????#???#??.? 3,1,2,4,1\n?#???.????#????.# 4,3,1,1\n???#????.???.?#??? 1,3,1,1,1,3\n???#??..#?.#??? 4,1,1,1\n.?#????.?.?## 1,1,3\n?.??##???#?.?#??.? 6,1\n?.###???#????#??? 1,4,4,2,1\n?.??##?.?#???##?. 1,2,1,5\n##??????#??#.???##?? 3,6,6\n#?.????##?#??#? 1,2,8\n???###.???#?#?#? 3,6\n#?.?.??#???#???# 2,1,5,1,2\n#?????#?????#??#? 1,1,11\n??????..?#? 2,1\n????.??????.??????? 1,1,1,2,4\n???????#???#?. 2,8\n??.????#?? 1,6\n?#.?????#.?#????.#?. 2,1,3,5,1\n?#?#??.?????#???? 4,7\n.??????.???????# 1,4\n#?#.???.?#? 3,1,2\n????#?..#? 1,2,2\n#????.#?#?.?????? 1,1,4,1,1\n?#????#?#??. 2,4\n?.#???????? 3,1,1\n??????#..???#??? 1,1,5\n????#??#???????? 6,2,1,1\n.#???#?#.##? 5,1,2\n????.??????.?.#??# 2,5,4\n??????#???#?.??#. 7,1,2,1,1\n????#???.#? 6,1\n?.??#?#????#??????? 5,5\n????#.##??.?? 2,1,2,1\n##??###?#???# 10,1\n?#????.???????##.# 3,1,1,1,5,1\n###??#?.??????? 7,3\n??#?##?..???? 4,1\n?????###???#?..? 9,2,1\n???#????#?. 6,2\n???##???#?.?###??. 3,2,6\n????#???#?##???? 2,8\n.??.????... 1,1\n??#..?????#.##?#??# 2,3,1,2,4\n.??????##?.? 2,2\n????#?.??.? 1,1,2\n???#??.???##? 4,1,1,2\n??.?##.#?.?#?? 2,3,1,4\n?????.?#??# 1,2,1\n???.??##??#? 2,2,1\n?.?#??##?##?#..?.?#? 5,4,2\n.#?#..?..?????.#? 3,1,4,1\n?#???#??????#?????#? 3,3,1,9\n#?#?#???????#?.#.?# 1,3,4,2,1,1\n???.????#??.? 2,5\n???##????#?.#. 3,3,1\n?????#?????. 1,2,2\n.???#???##?#?#?.?#.# 1,10,1,1\n?##?????###??.?..?. 4,6,1,1\n.??#?.???.? 1,2,1\n???##??????##??#?#? 4,2,2,4\n#????#?#?? 1,1,4\n????#?????? 4,4\n????#??..????#?..? 1,1,1,3,1,1\n?.??????.?#?# 1,1,1,4\n?#?????????##. 4,5\n?.###????#???? 6,1,1\n???????#?#???#?? 1,2,8,1\n???????#?#? 1,3\n?###?#??????#??????# 10,2,2,1\n?.????.??? 1,1,2\n.#?##????.?? 4,1\n??.??####??#.??# 9,2\n?.?.???.???#?# 1,1,4,1\n#?#?#?.#.?#??? 5,1,1,2\n??#?#?##???.#?#??#?? 1,9,1,1,1,1\n.???#??#??#??? 4,4,1\n???#?????.?.??????? 1,7,1,2,1,1\n?????###.#??#??.?.# 3,4,1,2,1,1\n?#??????#?????##??## 10,7\n??????????#???????? 7,4,2\n??#????#???? 7,1\n?.?#??.??? 1,2,2\n????..????????????? 2,3,4,2\n.??.???.??#? 1,1,1\n#????.??#?.???. 5,3,1,1\n???#?#??.?#???#?.#? 3,1,1,6,1\n.?????#????###?????? 12,2\n#?????#??????? 2,4,3\n?###??#???.#. 3,2,1\n??.????.??.?????##? 1,2,1,1,8\n?????.???? 1,2\n.?..?????. 1,1,1\n?.?####?#?#???????.? 1,9,1,1,2\n.????????????#??. 2,8\n?##???.???##??#? 5,7\n??????###.?#?? 1,1,4,4\n.?..?#???????? 2,2\n#??#?##??#?????#.??? 11,2,1,2\n.??#.????##.???? 2,1,2,1,1\n#???#???.??#.???? 3,1,1,3,4\n.??.???#?#?? 1,1,3\n.?#??????#?? 9,1\n??.?#?#???????##..? 1,13,1\n.??#??#?#?????##???? 1,14,1\n?#??#?#.????????? 6,2,2,1\n#?#??.???????#. 5,7\n????.#??#?? 1,5\n?#..#??????.?#? 2,6,2\n.?#...????##? 2,2,2\n.##.?#?.?.?#?.?# 2,2,1,3,1\n?????.??##?. 3,1,2\n?#???????#????????#? 2,1,2,1,5,1\n?##?.??????#? 3,1,1,2\n???.??#??.#?? 5,1\n.???#?#????###?#..? 4,7\n#????.???#?#?.?# 1,3,4,1,1\n?????#?#?.???.??.. 2,1,1,1,1,2\n.#???.?.??? 4,1\n.???#?#..? 1,3\n.?#?###???#??? 2,4,3\n?##???#??#? 2,6\n????.???##?.?? 1,1,4,1\n????#.???.??? 3,1,1\n?.??#???#??.?#. 5,1\n????.??????#???#??.. 3,7\n#.???#.????#.??? 1,2,1,3,1\n#?#?#????#???#?..?.? 14,1\n?#..??#???#? 1,2,2\n..#???.???#? 3,1,1\n?.???..???.??? 3,2,1\n#?#???????#??.??? 1,1,7,2\n??????.??.#???.??? 1,3,1,1,1,1\n?????#?#?#.????..#?? 8,2,3\n.????#.???##.? 5,3\n?#???.??.?# 3,1,2\n?.??#???.?.? 1,1,1,1\n??????...# 3,1,1\n.#??#??.?#???.??? 4,1,2,1,1\n???##?????????# 5,3,1\n?#????????#?? 5,1,1,1\n??..?#?..??.? 1,2,1,1\n.##??##?#???#?#?#? 2,5,3,1,2\n.??..#??.#?.??#???. 2,1,1,2,2,1\n??????##?????## 2,5,4\n??.??#??#????? 1,9\n???#??#??.?? 1,2,2,1\n#????.??????? 4,1,2,1\n???##.??#?#?#.#??# 5,7,1,1\n?????.?.??.?# 4,1,1,2\n#??#??##.#.? 1,6,1\n.?.??.?#?? 1,3\n?#?.??#.???.??#???#? 3,3,2,1,2,1\n??#?..??#??#???????? 2,9,1\n????#????. 1,4,1\n??#????.?????##?#?#? 2,2,1,5,1\n.???.???#? 3,1,2\n???????.??.? 2,1,1\n##?###???? 7,1\n?????????#?# 7,1,1\n.??#??##?#????#???? 2,12\n???????#?#? 1,5\n??.?#????? 1,1,1\n.?...#??#?#?? 1,2,1,1\n?????###?????#?#.? 12,1\n?#???##??## 1,8\n???#??.?.??.? 2,2\n.???.?.##??###?#???. 1,1,7,1,1\n?#??????#????.? 4,7\n????#?#????#??????? 9,1,6\n??#??..#?#? 1,3,4\n?.????##???#? 5,2\n???#????.??????# 1,1,1,1,5\n?#?#???###??#?..? 6,6\n..??????.. 1,1\n?.?#?.??#.?? 1,2,2,1\n????..?????# 1,1,2,1\n?.#??#??#.???#??# 7,1,1\n??.#??.??.???##?.??? 2,1,2,6,1,1\n??#?#..?.#??#?.?##?? 5,1,2,2,4\n.????..???? 2,2\n#???##.??.? 6,2\n.#???#??.#?#?#?## 7,8\n?.?..##??#? 1,5\n#????????.#??? 8,2\n.??.#??#???#?.?..?. 4,2\n?#???????#??#?.??# 1,1,7,1\n#???#??.??.???. 3,2,1,1\n.???#?????.. 2,1,1,1\n???????#??#?? 4,2,3\n??????.?.???..??.#? 1,1,1,3,2,1\n??.???#??..?? 1,5,1\n????#?????.????.? 7,2,1\n?.?#?#?.???#? 4,2\n.???#??#?? 1,1,3\n#????#???.?.??# 2,1,1,1,2\n#?#??.????? 5,1,1\n...#?????? 2,3\n..??..???? 1,3\n????##??????? 4,1\n?.#??.?#?.??# 3,1,1,1\n?#????#?.????? 7,1,1\n?.??#??.?.??. 3,1,1\n?#?#???.????. 4,4\n?.?...????.. 1,4\n????#?#???#?.?.# 9,1\n??.?????#?.?? 1,1,3,1\n?.#?.?.??. 1,1,1\n?.?#??#????#???.#?? 1,2,7,3\n?.??##?.?.#?.? 5,2\n??#.??#??#?.??? 2,6,1\n?.????#?#?#???? 1,4,6\n??#???..#???###????? 1,1,11\n?.???#.???.? 1,2,1,1\n?.???????.?.?###???? 1,1,1,1,3,3\n???##?#?.???.?????? 7,2,3\n????##????? 1,4\n.#?#??????#? 1,2,1,3\n??#?#?.????????. 2,1,8\n?.??#?.?#.??? 1,2,1,2\n???#??#?#.?????? 8,5\n??????#????#???? 1,13\n?.????.??.?#????#?? 1,2,1,1,5\n???.#?#?.. 1,4\n#??????#??? 3,6\n?.?###?#??..?#? 7,3\n??????#?.?.?????? 2,1,1,5\n?#???#.???###???? 3,1,1,5,2\n?????????#?#? 1,3,1,4\n?????.?????.?#??#? 3,2,4\n.#??????.#..??# 1,1,1,1,3\n.???#?###??????? 8,3\n??#????##?..?? 9,1\n.?#?#.??#?.? 2,1,3\n###???.???? 4,1,3\n?#.??#??## 2,2,3\n??..??.?#?#?##?. 1,8\n.??????????.? 3,5\n??.?#?#???... 1,6\n?????????.??????? 4,1,1,1,1\n???##?????.???? 7,4\n?##???#.?.??..?? 3,1,1,1,1\n??#??#?.???.#???# 1,1,1,1,5\n???#?##??.???. 7,2\n?????#???? 1,2,1\n#????????.??# 8,2\n??##??????#?#??? 5,5\n?.????????.???? 1,1,5,2,1\n?.??..????? 1,2\n??#??.?#?#?#????. 5,8\n????#?.???????#???#? 2,3,8,3\n..#???##.?????? 1,1,2,3\n#????#?##?#??????? 1,1,7,1,3\n#?.????????? 2,1,3\n????????.?#? 1,1,2,2\n.#?#??.?#???.##??? 5,5,2,1\n??????????#?? 9,1\n.?##?#????##? 6,3\n?.??##??#????##? 1,11\n???###????? 7,1\n#????##??##?.. 1,8\n?.??#??????????.? 5,3\n#???.???#?? 4,3\n.##??????#?.??. 4,1,1,2\n?#??????????. 1,2,3,1\n.???#?..#?.?????? 5,2\n.?#??????.?#??.?#? 1,1,1,2,1,2\n?#?##????#? 4,4\n???????#.?????#??#. 1,1,3,1,2,1\n??#?????????..???##. 4,1,2,5\n.???#.???.? 3,1,1\n?.?.?#?###??#??.# 1,1,6,3,1\n?#???#?#??..???####? 2,7,8\n.?.??????. 1,6\n#?#.?#??.??.????#? 1,1,2,1,6\n?.???????? 2,3\n..??????#??????? 8,1\n???#?????..???#?#?#. 7,8\n.#??????#?#??? 1,10\n???.??#.???. 3,1\n.??.??#?.?...? 2,3,1,1\n?.????????.###?.#? 1,1,1,1,4,2\n??#?????#? 1,1,5\n?..###?#???..???? 8,3\n???????????##.?. 1,2,7,1\n#?###.????? 5,2,1\n..?????..?????.? 3,1\n.?#??.?#.??????. 3,2,5\n?.?#.#??.? 2,3,1\n..?#????????????.? 3,2\n#????#??#???????? 9,4\n????????.#????#.?? 7,6,1\n??????#?.??##?? 2,3,3\n.????#.??? 1,1,1\n?????????????#???.?? 4,8,1\n.??#??????#? 3,4\n?.#???#.???? 1,5,3\n.?.?#??#???#???? 1,1,2,6\n.??.#??.?.?#??????? 2,1\n??..#.?..? 1,1,1\n.#???#?.#.???.???.? 5,1,2,3\n????#.????#???#..??? 2,1,3,5,1,1\n.???????????#??????. 7,4,2\n#??#??#.?.?.???? 7,1,1,1\n.?.????#?????#?????? 5,9\n????#????#???.?#??? 13,2,1\n???????#?##?..# 1,4,5,1\n??#???.???#?...## 3,1,3,2\n?????.??.???.? 2,1,1,1\n#??#??????? 7,1\n??.#???#?????? 1,2,8"

	def main(args: Array[String]): Unit =
	{
		val lines = input1.split('\n').toList
		val records = lines.map(extract).map(_.mult(5))
		//val records = lines.map(extract2(_,5))
		val combs = records.map(_.combsPrint)
		records.zip(combs).foreach(p=> println(p._1+" = "+p._2))
		println("Total = "+combs.sum)
	}

	def extract(line: String): Record = {
		val s"$springs $groups" = line
		Record(springs, groups.split(',').toList.map(_.toInt))
	}

	val WORKING = '.'
	val BROKEN = '#'

	var n = 0

	val cache = mutable.Map[Record,Long]()

	case class Record(springs: String, groups: List[Int])
	{
		val min = groups.sum+groups.size-1

		def mult(by: Int): Record = {
			val mSprings = (0 until by).map(i=> springs.mkString).mkString("?")
			val mGroups = (0 until by).flatMap(i => groups).toList
			Record(mSprings, mGroups)
		}

		def combsPrint: Long = {
			val c = combs
			println(s"$n $c")
			n+= 1
			c
		}

		def combs: Long = {
			val cached = cache.get(this)
			if (cached.isDefined) cached.get
			else {
				val c = {
					if (springs.size<min) 0
					else groups match
					{
						case Nil => if (springs.contains(BROKEN)) 0 else 1
						case g :: tail => Record(springs, tail).combs(g)
					}
				}
				cache+= this -> c
				c
			}
		}

		def combs(group: Int): Long =
		{
			if (springs.size<group) 0
			else {
				val newC = if (springs.head==BROKEN) 0 else Record(springs.tail.dropWhile(_==WORKING), groups).combs(group)
				val (prefix,suffix) = springs.splitAt(group)
				if (prefix.forall(_!=WORKING)) {
					if (suffix.isEmpty) {
						if (groups.isEmpty) 1 else 0
					}
					else {
						if (suffix.head==BROKEN)
							newC
						else
							newC + Record(suffix.tail.dropWhile(_==WORKING), groups).combs
					}
				}
				else newC
			}
		}

		def combs2: Long = {
			if (springs.size<min) 0
			else
			{
				groups match
				{
					case Nil => if (springs.contains(BROKEN)) 0 else 1
					case g :: tail =>
					{
						val springs2 = springs.dropWhile(_==WORKING)
						val prefixLen = springs2.takeWhile(_ != WORKING).size
						val suffix = springs2.drop(prefixLen)
						var revTrying = List(g)
						var remaining = tail
						var fits = nFits(prefixLen, revTrying.reverse)
						var count = 0L
						while (fits>0) {
							count+= fits*Record(suffix, remaining).combs2
							remaining match {
								case Nil => {fits = 0}
								case h::tail => {
									revTrying = h::revTrying
									remaining = tail
									fits = nFits(prefixLen, revTrying.reverse)
								}
							}
						}
						count
					}
				}
			}
		}

		override def toString: String = springs.mkString("")+" "+groups.mkString(",")


	}

	def nFits(len: Int, groups: List[Int]): Long = groups match {
		case Nil => 1
		case List(g) => 1+len-g
		case g1::g2::tail => {
			val minReq = g2+tail.sum+tail.size
			val maxAvail = len-g1-1
			(minReq to maxAvail).map(nFits(_, tail)).sum
		}
	}

	def tokens(s: String): List[String] = s.split(' ').toList.map(_.trim).filter(_.size>0)


}